
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>CLI &#8212; MECADOI  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Library" href="library.html" />
    <link rel="prev" title="API Reference" href="../reference.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="cli">
<h1>CLI<a class="headerlink" href="#cli" title="Permalink to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#python-m-src" id="id1">python -m src</a></p>
<ul>
<li><p><a class="reference internal" href="#python-m-src-batch" id="id2">batch</a></p>
<ul>
<li><p><a class="reference internal" href="#python-m-src-batch-deposit" id="id3">deposit</a></p></li>
<li><p><a class="reference internal" href="#python-m-src-batch-parse" id="id4">parse</a></p></li>
<li><p><a class="reference internal" href="#python-m-src-batch-prune" id="id5">prune</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#python-m-src-meca" id="id6">meca</a></p>
<ul>
<li><p><a class="reference internal" href="#python-m-src-meca-info" id="id7">info</a></p></li>
<li><p><a class="reference internal" href="#python-m-src-meca-reviews" id="id8">reviews</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<section id="python-m-src">
<h2>python -m src<a class="headerlink" href="#python-m-src" title="Permalink to this heading">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>python -m src <span class="o">[</span>OPTIONS<span class="o">]</span> COMMAND <span class="o">[</span>ARGS<span class="o">]</span>...
</pre></div>
</div>
<section id="python-m-src-batch">
<h3>batch<a class="headerlink" href="#python-m-src-batch" title="Permalink to this heading">¶</a></h3>
<p>Create DOIs for peer reviews and author replies in MECA archives.</p>
<p>All actions taken during these commands are recorded in the MECADOI database.
Its location can be set through the <cite>DB_URL</cite> parameter in the <cite>.env</cite> file.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>python -m src batch <span class="o">[</span>OPTIONS<span class="o">]</span> COMMAND <span class="o">[</span>ARGS<span class="o">]</span>...
</pre></div>
</div>
<section id="python-m-src-batch-deposit">
<h4>deposit<a class="headerlink" href="#python-m-src-batch-deposit" title="Permalink to this heading">¶</a></h4>
<p>Create DOIs for MECA archives in the MECADOI database.</p>
<p>The command finds those MECA archives in the MECADOI database for which DOIs can be deposited,
i.e. those that have reviews and a preprint DOI and for which no deposition has been attempted
yet.
Then a deposition attempt is made for each selected MECA and its result recorded in the MECADOI
database.
Information about each successful deposition attempt is written to a file in <cite>–output-dir</cite>.</p>
<p>DOIs are deposited by sending an XML file conforming to the Crossref metadata schema to the
Crossref API.
Emails with detailed information about the status of every submission is sent to the depositor’s
email address, which is taken from the <cite>DEPOSITOR_EMAIL</cite> variable in your <cite>.env</cite> file.
Failures in the deposition data (e.g. malformed DOIs) are only reported in this email, i.e. this
command almost always executes successfully.</p>
<p>Before a deposition is attempted the DOIs to be created are verified against the EEB platform
(eeb.embo.org).
If any review or reply already has a DOI, or if the amount of reviews and replies don’t match
exactly, the attempt is marked as failed.</p>
<p>The ID of this command invocation and a list of all processed MECA archives is printed to stdout.
The MECA archives are grouped by their status:</p>
<div class="line-block">
<div class="line">- <cite>deposition_generation_failed</cite> if the Crossref XML file could not be generated</div>
<div class="line">- <cite>dois_already_present</cite> if at least one review or reply in the MECA archive already has a DOI</div>
<div class="line">- <cite>deposition_verification_failed</cite>  if the reviews and replies in the MECA archive don’t exactly match those on EEB</div>
<div class="line">- <cite>deposition_succeeded</cite> if the deposition XML was accepted by the Crossref API</div>
<div class="line">- <cite>deposition_failed</cite> if the deposition XML was not accepted by or could not be sent to the Crossref API</div>
</div>
<p>NOTE: By default, this command will <em>not</em> create any DOIs or update the MECADOI database. Pass
the <cite>–no-dry-run</cite> option to actually execute the irreversible deposition and update the database.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>python -m src batch deposit <span class="o">[</span>OPTIONS<span class="o">]</span>
</pre></div>
</div>
<p class="rubric">Options</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-python-m-src-batch-deposit-o">
<span id="cmdoption-python-m-src-batch-deposit-output-dir"></span><span class="sig-name descname"><span class="pre">-o</span></span><span class="sig-prename descclassname"></span><span class="sig-prename descclassname"><span class="pre">,</span> </span><span class="sig-name descname"><span class="pre">--output-dir</span></span><span class="sig-prename descclassname"> <span class="pre">&lt;output_dir&gt;</span></span><a class="headerlink" href="#cmdoption-python-m-src-batch-deposit-o" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Required</strong> The directory to which a file with information about successful deposition attempts is written.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-python-m-src-batch-deposit-dry-run">
<span id="cmdoption-python-m-src-batch-deposit-no-dry-run"></span><span class="sig-name descname"><span class="pre">--dry-run</span></span><span class="sig-prename descclassname"></span><span class="sig-prename descclassname"><span class="pre">,</span> </span><span class="sig-name descname"><span class="pre">--no-dry-run</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-python-m-src-batch-deposit-dry-run" title="Permalink to this definition">¶</a></dt>
<dd><p>Only show what would happen / actually create DOIs and update the database. DEFAULT: <cite>–dry-run</cite></p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-python-m-src-batch-deposit-retry-failed">
<span id="cmdoption-python-m-src-batch-deposit-no-retry-failed"></span><span class="sig-name descname"><span class="pre">--retry-failed</span></span><span class="sig-prename descclassname"></span><span class="sig-prename descclassname"><span class="pre">,</span> </span><span class="sig-name descname"><span class="pre">--no-retry-failed</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-python-m-src-batch-deposit-retry-failed" title="Permalink to this definition">¶</a></dt>
<dd><p>Re-try DOI deposition for MECA archives for which a previous attempt has failed / deposit DOIs for MECA archives without deposition attempt. DEFAULT: <cite>–no-retry-failed</cite></p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-python-m-src-batch-deposit-a">
<span id="cmdoption-python-m-src-batch-deposit-after"></span><span class="sig-name descname"><span class="pre">-a</span></span><span class="sig-prename descclassname"></span><span class="sig-prename descclassname"><span class="pre">,</span> </span><span class="sig-name descname"><span class="pre">--after</span></span><span class="sig-prename descclassname"> <span class="pre">&lt;after&gt;</span></span><a class="headerlink" href="#cmdoption-python-m-src-batch-deposit-a" title="Permalink to this definition">¶</a></dt>
<dd><p>Only attempt to deposit DOIs for MECA archives that were received after this date. Example: 2022-04-01</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-python-m-src-batch-deposit-b">
<span id="cmdoption-python-m-src-batch-deposit-before"></span><span class="sig-name descname"><span class="pre">-b</span></span><span class="sig-prename descclassname"></span><span class="sig-prename descclassname"><span class="pre">,</span> </span><span class="sig-name descname"><span class="pre">--before</span></span><span class="sig-prename descclassname"> <span class="pre">&lt;before&gt;</span></span><a class="headerlink" href="#cmdoption-python-m-src-batch-deposit-b" title="Permalink to this definition">¶</a></dt>
<dd><p>Only attempt to deposit DOIs for MECA archives that were received before this date. Example: 2022-10-01</p>
</dd></dl>

</section>
<section id="python-m-src-batch-parse">
<h4>parse<a class="headerlink" href="#python-m-src-batch-parse" title="Permalink to this heading">¶</a></h4>
<p>Import files into the MECADOI database.</p>
<p>The command archives all files in <cite>INPUT_DIR</cite> to a new folder in <cite>–output-dir</cite>, tries to parse
them as MECA archives, and registers them in the MECADOI database.</p>
<p>The processed files are moved to a subfolder named <cite>parsed/&lt;id&gt;/</cite> within <cite>–output-dir</cite>, where
&lt;id&gt; is the unique ID generated for this command invocation.</p>
<p>The ID of this command invocation and a list of all processed files is printed to stdout. The
files are grouped by their status:</p>
<div class="line-block">
<div class="line">- <cite>invalid</cite> for files that are not MECA archives (e.g. non-ZIP files)</div>
<div class="line">- <cite>no_reviews</cite> for MECA archives that contain no reviews or author replies</div>
<div class="line">- <cite>no_preprint_doi</cite> for MECA archives that contain no preprint DOI (required for DOI creation)</div>
<div class="line">- <cite>ready_for_deposition</cite> for MECA archives where review and author reply DOIs can be created</div>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>python -m src batch parse <span class="o">[</span>OPTIONS<span class="o">]</span> INPUT_DIR
</pre></div>
</div>
<p class="rubric">Options</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-python-m-src-batch-parse-o">
<span id="cmdoption-python-m-src-batch-parse-output-dir"></span><span class="sig-name descname"><span class="pre">-o</span></span><span class="sig-prename descclassname"></span><span class="sig-prename descclassname"><span class="pre">,</span> </span><span class="sig-name descname"><span class="pre">--output-dir</span></span><span class="sig-prename descclassname"> <span class="pre">&lt;output_dir&gt;</span></span><a class="headerlink" href="#cmdoption-python-m-src-batch-parse-o" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Required</strong> The directory to which processed files will be archived. Must be an existing directory.</p>
</dd></dl>

<p class="rubric">Arguments</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-python-m-src-batch-parse-arg-INPUT_DIR">
<span id="cmdoption-python-m-src-batch-parse-arg-input-dir"></span><span class="sig-name descname"><span class="pre">INPUT_DIR</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-python-m-src-batch-parse-arg-INPUT_DIR" title="Permalink to this definition">¶</a></dt>
<dd><p>Required argument</p>
</dd></dl>

</section>
<section id="python-m-src-batch-prune">
<h4>prune<a class="headerlink" href="#python-m-src-batch-prune" title="Permalink to this heading">¶</a></h4>
<p>Delete MECA archives that are no longer needed for deposition.</p>
<p>All MECA archives are parsed during the initial import and all information necessary for DOI
creation is stored in the MECADOI database. After this step, the actual file on disk is no
longer needed to create DOIs.</p>
<p>This command checks the file path of every MECA archive registered in the MECADOI database and
deletes those files that exist on disk.</p>
<p>NOTE: By default, this command will <em>not</em> delete any files. Pass the <cite>–no-dry-run</cite> option to
actually execute the deletions.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>python -m src batch prune <span class="o">[</span>OPTIONS<span class="o">]</span>
</pre></div>
</div>
<p class="rubric">Options</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-python-m-src-batch-prune-dry-run">
<span id="cmdoption-python-m-src-batch-prune-no-dry-run"></span><span class="sig-name descname"><span class="pre">--dry-run</span></span><span class="sig-prename descclassname"></span><span class="sig-prename descclassname"><span class="pre">,</span> </span><span class="sig-name descname"><span class="pre">--no-dry-run</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-python-m-src-batch-prune-dry-run" title="Permalink to this definition">¶</a></dt>
<dd><p>Only show what would happen / actually delete MECA archives. DEFAULT: <cite>–dry-run</cite></p>
</dd></dl>

</section>
</section>
<section id="python-m-src-meca">
<h3>meca<a class="headerlink" href="#python-m-src-meca" title="Permalink to this heading">¶</a></h3>
<p>Read information from a MECA archive.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>python -m src meca <span class="o">[</span>OPTIONS<span class="o">]</span> COMMAND <span class="o">[</span>ARGS<span class="o">]</span>...
</pre></div>
</div>
<section id="python-m-src-meca-info">
<h4>info<a class="headerlink" href="#python-m-src-meca-info" title="Permalink to this heading">¶</a></h4>
<p>Show basic information about the manuscript in a MECA archive.</p>
<p>Parses the file at <cite>MECA_ARCHIVE</cite> and prints the authors, journal, title, any DOIs, and a
summary of the peer review process of the manuscript to stdout.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>python -m src meca info <span class="o">[</span>OPTIONS<span class="o">]</span> MECA_ARCHIVE
</pre></div>
</div>
<p class="rubric">Arguments</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-python-m-src-meca-info-arg-MECA_ARCHIVE">
<span id="cmdoption-python-m-src-meca-info-arg-meca-archive"></span><span class="sig-name descname"><span class="pre">MECA_ARCHIVE</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-python-m-src-meca-info-arg-MECA_ARCHIVE" title="Permalink to this definition">¶</a></dt>
<dd><p>Required argument</p>
</dd></dl>

</section>
<section id="python-m-src-meca-reviews">
<h4>reviews<a class="headerlink" href="#python-m-src-meca-reviews" title="Permalink to this heading">¶</a></h4>
<p>Show information about the review process of the manuscript in a MECA archive.</p>
<p>Parses the file at <cite>MECA_ARCHIVE</cite> and prints the authors, date, and a summary of all reviews
and author replies of the manuscript to stdout.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>python -m src meca reviews <span class="o">[</span>OPTIONS<span class="o">]</span> MECA_ARCHIVE
</pre></div>
</div>
<p class="rubric">Arguments</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-python-m-src-meca-reviews-arg-MECA_ARCHIVE">
<span id="cmdoption-python-m-src-meca-reviews-arg-meca-archive"></span><span class="sig-name descname"><span class="pre">MECA_ARCHIVE</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-python-m-src-meca-reviews-arg-MECA_ARCHIVE" title="Permalink to this definition">¶</a></dt>
<dd><p>Required argument</p>
</dd></dl>

</section>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">MECADOI</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project.html">Project Background</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../reference.html">API Reference</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">CLI</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#python-m-src">python -m src</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#python-m-src-batch">batch</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#python-m-src-batch-deposit">deposit</a></li>
<li class="toctree-l5"><a class="reference internal" href="#python-m-src-batch-parse">parse</a></li>
<li class="toctree-l5"><a class="reference internal" href="#python-m-src-batch-prune">prune</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#python-m-src-meca">meca</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#python-m-src-meca-info">info</a></li>
<li class="toctree-l5"><a class="reference internal" href="#python-m-src-meca-reviews">reviews</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="library.html">Library</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../reference.html">API Reference</a><ul>
      <li>Previous: <a href="../reference.html" title="previous chapter">API Reference</a></li>
      <li>Next: <a href="library.html" title="next chapter">Library</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, SourceData.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/api/cli.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>